# rest_to_go

Телеграмм-бот, который помогает выбрать место для встречи.

# Авторы

- Шавалиева Алина Рафаэлевна (367628)
- Москалева Екатерина Александровна (466768)

## Описание

Бот рассчитывает расстояния между локациями и помогает найти идеальное место для встречи двух людей. Просто отправьте свои координаты — бот мгновенно определит оптимальную точку.

Процесс состоит из трех этапов:
1. Сначала вы забиваете в бота все локации, с которых вы начинаете (`/add_source`)
2. Затем забиваете разные варианты, куда хотите прийти (`/add_destination`)
3. Бот выбирает один вариант из второго пункта, в котором вы все окажетесь
  быстрее всего (минимальное максимальное время) (`/best`).

## Особенности

- Точный расчет времени на машине и расстояний между точками на карте
- Интеллектуальный подбор лучшего места встречи для двух пользователей
- Удобный интерфейс с интерактивными кнопками и быстрым ответом
- Состояние бота общее для всех его пользователей: каждый может параллельно добавлять свои любимые места, а бот поможет выбрать самое удобное
- Доступ в бота по whitelist
- В Телеграме отображается список всех доступных команд бота с описанием

# Запуск

> Тестировалось на Python 3.13.0

Сначала клонируем себе проект:

```bash
git clone git@github.com:alino3ka/rest_to_go.git
```

И ставим себе зависимости (лучше в виртуальное окружение):

```bash
python3 -m venv venv
./venv/bin/pip install -r requirements.txt
```

После всего этого нам надо получить два токена:
- Токен от телеграм бота: пишем [@BotFather](https://t.me/BotFather),
  запускаем `/newbot` и отвечаем на его вопросы.
- API ключ от OpenRouterService: он будет в личном кабинете https://account.heigit.org/,
  зарегистрироваться там можно через github

Потом нам нужно сконфигурировать бота. Конфигурируется он либо через переменные
окружения, либо через файл `.env`. Файл выглядит примерно так:

```
BOT_TOKEN=12345
OPENROUTESERVICE_TOKEN=12345
STORAGE_PATH=.storage
INITIAL_USER_ID=12345
LOG_LEVEL=INFO
```

- `BOT_TOKEN` --- тут надо указать токен от телеграм бота
- `OPENROUTESERVICE_TOKEN` --- тут API ключ от сервиса карт
- `STORAGE_PATH` --- по этому пути бот будет хранить информацию,
  которая сохраняется между перезапусками
- `INITIAL_USER_ID` --- ID пользователя, который будет изначально
  помещен в whitelist (получить его можно написав [@userinfobot](https://t.me/userinfobot))
- `LOG_LEVEL` --- с какой детальностью логировать действия (`DEBUG`, `INFO`, `WARN`, `ERROR`)

Чтобы запустить бота достаточно выполнить команду:

```bash
./venv/bin/python bot.py
```

Также лог действий можно перенаправить в файл через стандартные средства
оболочки (`> file.log`).

## Команды бота

- /add_destination - Добавить новое место назначения
- /sources - Список всех источников
- /destinations - Список всех мест назначения
- /clear_sources - Очистить все известные источники
- /clear_destinations - Очистить все известные места назначения
- /matrix - Рассчитать матрицу расстояний
- /best - Найти лучшее место назначения из всех источников
- /add_user - Добавить пользователя в whitelist
- /remove_user - Удалить пользователя из whitelist
- /stats - Статистика бота
- /help - Показать справку
- /cancel - Отменить текущую операцию
- /language_ru - Установить русский язык
- /language_en - Установить английский язык

